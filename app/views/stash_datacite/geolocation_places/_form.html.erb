<script>
  // based on example at http://jqueryui.com/autocomplete/#remote-jsonp
  $(function() {
    function split( val ) {
      return val.split( /,\s*/ );
    }
    function extractLast( term ) {
      return split( term ).pop();
    }

    $( "#geo_place" )
      // don't navigate away from the field on tab when selecting an item
      .bind( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        source: function( request, response ) {
          $.ajax({
            url: "https://search.mapzen.com/v1/search?api_key=search-OJQOSkw&text="+ extractLast( request.term ),
            dataType: "json",
            success: function( data ) {
              var id_labels = jQuery.map( data.features, function( a ) {
                return [[ a.properties.id, a.properties.label ]];
              });
              var items = [];
              $.each(id_labels, function(index, value) {
                items.push(value[1]);
              });
              response(items);
            }
          });
        },
        minLength: 2,
        focus: function() {
          // prevent value inserted on focus
          return false;
        },
      });
    });
</script>

<%# the local variable 'geolocation_place' should be passed in to this partial when there are multiple per page %>
<%= form_for(geolocation_place, url: stash_datacite.geolocation_places_create_path, remote: true, authenticity_token: true, html: {id: "geolocation_place_new_form"}) do |f| %>
  <%#= render "datacite/shared/error_messages", :target => @geolocation_point %>
  <strong><%= label_tag "Add a place by name" %></strong><br/>
  <%= image_tag("stash_datacite/globe.png", size: "20x20", alt: "Place") %>&nbsp;
  <%= f.text_field :geo_location_place, placeholder: 'Search by Name', class: 'geo', id: "geo_place", size:50 %>&nbsp;&nbsp;
  <%= f.hidden_field :resource_id %>
  <%= f.submit "Add", id: "add_geo_place" %>
  <br/>
<% end %>
<br/>