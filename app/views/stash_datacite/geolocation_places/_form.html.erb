<script>
  // based on example at http://jqueryui.com/autocomplete/#remote-jsonp
  $(function() {
    function log( message ) {
      $( "<div>" ).text( message ).prependTo( "#log" );
      $( "#log" ).scrollTop( 0 );
    }

      // don't navigate away from the field on tab when selecting an item
      // .bind( "keydown", function( event ) {
      //   if ( event.keyCode === $.ui.keyCode.TAB &&
      //       $( this ).autocomplete( "instance" ).menu.active ) {
      //     event.preventDefault();
      //   }
      // })
    $( "#geo_place" ).autocomplete({
      source: function( request, response ) {
        $.ajax({
          url: "https://search.mapzen.com/v1/search?api_key=search-OJQOSkw&text="+ request.term,
          dataType: "json",
          success: function( data ) {
            console.log(data);
            var geoObject = JSON.parse(data);
            var features = [];
            features = geoObject.features;
            console.log(features);
          }
        });
      },
      minLength: 3,
      select: function( event, ui ) {
        log( ui.item ?
          "Selected: " + ui.item.label :
          "Nothing selected, input was " + this.value);
      },
      open: function() {
        $( this ).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
      },
      close: function() {
        $( this ).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
      }
    });
  });
</script>

<%# the local variable 'geolocation_place' should be passed in to this partial when there are multiple per page %>
<p>Where was the data collected? Does it focus on particular locations?</p>
<%= form_for(geolocation_place, url: stash_datacite.geolocation_places_create_path, remote: true, authenticity_token: true, html: {id: "geolocation_place_new_form"}) do |f| %>
  <%#= render "datacite/shared/error_messages", :target => @geolocation_point %>
  <strong><%= label_tag "Add a place by name" %></strong><br/>
  <%= image_tag("stash_datacite/globe.png", size: "20x20", alt: "Place") %>&nbsp;
  <%= f.text_field :geo_location_place, placeholder: 'Search by Name', class: 'geo', id: "geo_place", size:50 %>&nbsp;&nbsp;
  <%= f.hidden_field :resource_id %>
  <%= f.submit "Add", id: "add_geo_place" %>
  <br/>
<% end %>
<br/>
<strong><%= label_tag "Add a point or rectangular area with lat/long coordinates" %></strong><br/>
<div style="float:left"><%= link_to(image_tag("stash_datacite/geo_point.png", size: "30x30", alt: "Point", id: "geo_point"), '#')  %><%= link_to(image_tag("stash_datacite/geo_box.png", size: "30x30", alt: "Box", id: "geo_box"), '#') %>&nbsp;&nbsp;</div>