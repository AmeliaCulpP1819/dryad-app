<% @page_title = 'Upload Your Files - Publish and Preserve your Data' %>
<%= render partial: 'stash_engine/shared/dataset_steps_nav' %>

<h1 class="o-heading__level1">Upload Your Files <span class="t-upload__heading-optional">(optional)</span></h1>

<div id="choose_method">
  <%= render partial: 'stash_engine/file_uploads/choose_upload_method', locals: { resource: @resource} %>
</div>


<!-- manifest workflow -->
<div class="manifest_upload" style="display: none;" class="limits_and_part_2">
  <%= render partial: 'stash_engine/file_uploads/manifest_upload',
       locals: { resource: @resource } %>
</div>

<!-- file upload workflow -->
<div class="files_upload" style="display: none;">
  <%= render partial: 'stash_engine/file_uploads/files_upload', locals: { file: @file, resource: @resource, uploads: @uploads } %>
</div>

<div class="o-dataset-nav">
  <%= link_to 'Back to Describe Dataset', metadata_entry_pages_find_or_create_path(resource_id: params[:id]), class: 'o-button__icon-left', role: 'button', id: 'describe_back' %>
  <%= link_to 'Proceed to Review', review_resource_path(params[:id]), class: 'o-button__icon-right', role: 'button', id: 'proceed_review' %>
</div>











<script type="text/javascript" charset="utf-8">
  var uploadInProgress = false;
  $(function () {
    // Initialize the jQuery File Upload widget:
    $('#fileupload').fileupload({
      maxChunkSize: 1048576,
      //acceptFileTypes: /(\.|\/)(gif|jpe?g|png|tif?f)$/i
      maxFileSize: <%= current_tenant.max_file_size %>,// 2GB,
      //maxFileSize: 1048576 ,// 1MB,
      limitMultiFileUploadSize: <%= current_tenant.max_submission_size %>
    });
    $('#upload_all').click(function(){
      $('#upload_complete').hide();
      $('#over_single_size').empty();
    });
  });

  function maxTotalSize(){
    return <%= current_tenant.max_total_version_size %>;
  }

  function maxSubmissionSize(){
    return <%= current_tenant.max_submission_size %>;
  }

  function maxFileSize(){
    return <%= current_tenant.max_file_size %>;
  }

  function overTotalSize(mySize){
    return (mySize > maxTotalSize());
  }

  function overSubmissionSize(mySize){
    return (mySize > maxSubmissionSize());
  }

  function overFileSize(mySize){
    return (mySize > maxFileSize());
  }

  function versionNumber(){
    return <%= @resource.version_number %>;
  }

  function resourceId(){
    return <%= @resource.id %>;
  }

  function showFilesResourcePath(){
    return "<%= show_files_resource_path @resource %>";
  }

  function removeUnuploadedFileUploadPath(){
    return "<%= remove_unuploaded_file_upload_path @resource %>";
  }

  function maxFiles(){
    return <%= current_tenant.max_files %>;
  }

  updateButtonLinkStates(); // for file upload method

  $(function () {
    // set up initial page loaded state
    showFilesOrManifest(); // decides to either show files or manifest uploads based on select list state
    addSelectUploadTypeEvent();  // adds change event for switching files vs manifest
    setUploadMethodLockout('<%= @resource.upload_type %>'); // set lockout so you can't change view if you have files already
    $('#post_submit_spinner').hide(); // hide the submit spinner for manifest uploads
    $('#table_hider').hide(); // hides > 10 rows of manifest table if it's long
    $('#show_10_files').hide(); // hide link to only show 10 files
    hideLinksForFewRows(); // hide both links if fewer than 10 files total
    addEventFewManyRows();
    confirmToValidate(); // add event to require checking acceptance before validating
  });

  $( document ).ready(function() {
    $('#files_from_computer').click(function(){
      updateUiStates();
    });
  });

</script>